---
title: "Getting started with supreme"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started with supreme}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
library(supreme)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

## Create new models from scratch

### Read files containing your Shiny application

In **supreme** package, we provide path lead to an example application of Shiny
created with modules that resides in `inst/extdata` [*directory*](#todo-add-link) of the repository.

You can get the paths for the example app by calling `example_app_path()`:

```{r}
paths <- example_app_path()
paths
```

Then create a `supreme` object:

```{r}
s <- supreme(src_file(paths))
```

Visualize:

```{r}
graph(s)
```

Those all can be also done using pipes (`%>%`) from the [magrittr](https://cran.r-project.org/package=magrittr) package:

```{r, eval=FALSE}
src_file(paths) %>%
  supreme() %>% 
  graph()
```

### Read package containing Shiny application

The helper function `example_package()` contains an R package named `supreme.pkg.test` placed in [*this repository*](https://github.com/strboul/supreme.pkg.test).

```{r}
pkg.name <- example_package()
sup <- supreme(src_pkg(pkg.name))
graph(sup)
```


### Read expressions containing application

Create a new expression in R, and you will be able to analyze it by creating a supreme object:

```{r}
e <- expression({
  library(shiny)
  
  text_ui <- function(id) {
    ns <- NS(id)
    tagList(textInput(ns("text"), "Write here"),
            verbatimTextOutput(ns("display")))
  }
  
  text_server <- function(input, output, session) {
    rv.text <- reactiveValues(val = FALSE)
    
    observeEvent(input$text, {
      rv.text$val <- input$text
    })
    
    output$display <- renderText({
      rv.text$val
    })
    
  }
  
  ui <- fluidPage(fluidRow(
    column(6,
           text_ui("text"))
  ))
  
  server <- function(input, output, session) {
    callModule(module = text_server, id = "text")
  }
  
  shinyApp(ui, server)
})
s <- supreme(src_expr(e))
graph(s)
```

### Read application environment

```{r}
e <- example_environment()
s <- supreme(src_env(e))
graph(s)
```

## Analyse existing applications

### Creating YAML model objects

Model definition with YAML[^1] is quite useful to design new application or design part of the logic in the application.

Therefore, you can plan how modules should work each other, what module will call which, and what inputs they will have.

```{r}
model <- '
  - type: module
    name: server
    calling_modules: [items_tab_module_server, customers_tab_module_server, transactions_tab_module_server]
  
  - type: module
    name: items_tab_module_server
  
  - type: module
    name: customers_tab_module_server
    
  - type: module
    name: transactions_tab_module_server
'
```

There are some special rules when creating models with YAML. 

+ Each entity in the model must have 
*`r mmy::list_en_end(supreme:::SUPREME_REQUIRED_FIELDS, add.quotes=T)`* fields.

+ The entities can have optional fields which are
*`r mmy::list_en_end(supreme:::SUPREME_OPTIONAL_FIELDS, add.quotes=T)`*.

Any other field, which is not known by the supreme modal object, added to the model
definition would throw an error (e.g. adding a field called `apple: green` isn't
allowed).

See the [*Model language*](#model-language) section for explanation of these fields.

Create a supreme mode object:
```{r}
obj <- supreme(src_yaml(text = model))
obj
```

Visualize the supreme mode object:
```{r, fig.width = 7, fig.height=7}
graph(obj)
```


## Model language

In this context, an '*entity*' means that it is a Shiny module having such
attributes:

```{r,results='asis'}
fields <-  c(
  supreme:::SUPREME_REQUIRED_FIELDS,
  supreme:::SUPREME_OPTIONAL_FIELDS
)
for (field in fields) {
  cat("+", field, "\n\n")
}
```

## Notes

[^1]: YAML is a popular is a human-readable data-serialization language. <https://yaml.org/>

